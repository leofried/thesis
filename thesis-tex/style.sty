\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{microtype}
\usepackage[most]{tcolorbox}
\usepackage[hidelinks]{hyperref}
\usepackage{complexity}
\usepackage{float}
\usepackage{subfiles}
\usepackage{tocloft}
\usepackage{tikz-cd}
\usepackage{pifont}
\usepackage{xcolor}
\usepackage{indentfirst}
\usepackage{fullpage} 
\usepackage[shortlabels]{enumitem}
\usepackage{multirow}
\usepackage{etoolbox}
\usepackage[defernumbers=true]{biblatex}

% \usepackage{minitoc}
% \usepackage{titletoc}
\usepackage{etoc}

\renewcommand*{\mkbibnamefamily}[1]{\textsc{#1}}
\DeclareNameAlias{author}{family-given}
\addbibresource{refs.bib}


\usepackage{imakeidx}
\usepackage[columns=1]{idxlayout}
\makeindex
\indexsetup{level=\section}

\hbadness=10000


\newcommand{\toc}{
    \tableofcontents
    \addtocontents{toc}{
        \cftpagenumbersoff{sec}
    }
    \thispagestyle{empty}
    \newpage
}

\newcommand{\ttl}{
    \subfile{sections/title}
    \thispagestyle{empty}
    \newpage
}

\newcommand{\sub}[1]{
    \documentclass[../../main.tex]{subfiles}
    \begin{document}
    #1
    \end{document}
}


\newcommand{\sectiontoc}[1]{%
    \renewcommand{\contentsname}{}
    \vspace*{-1cm}%
    \etocsetnexttocdepth{subsection}
    \localtableofcontents
}

\newcommand{\secti}[1]{
    \section{#1}
    \sectiontoc{#1}
    \def\sectname{#1}
    \label{cha:#1}
    \newpage
}

\newcommand{\subsect}[1]{
    \def\subsectname{#1}
    \subsection{#1}
    \label{sec:#1}
    \subfile{sections/\sectname/#1}
    \newpage
}

\newtcbtheorem[number within=subsection]{theorem}{Theorem}{enhanced, breakable, colback=purple!5,colframe=violet!100!,fonttitle=\bfseries}{th}
\newtcbtheorem[number within=subsection, use counter from=theorem]{lemma}{Lemma}{enhanced, breakable, colback=purple!5,colframe=violet!100!,fonttitle=\bfseries}{th}
\newtcbtheorem[number within=subsection, use counter from=theorem]{corollary}{Corollary}{enhanced, breakable, colback=purple!5,colframe=violet!100!,fonttitle=\bfseries}{th}

\newtcbtheorem[number within=subsection, use counter from=theorem]{definition}{Definition}
{enhanced, breakable, colback=blue!5,colframe=teal!100!,fonttitle=\bfseries}{def}


\newtcbtheorem[number within=subsection, use counter from=theorem]{figg}{Figure}
{enhanced, width=\linewidth, breakable, colback=red!5,colframe=purple!100!,fonttitle=\bfseries}{fig}

\newtcbtheorem[number within=subsection, use counter from=theorem]{oq}{Open Question}{enhanced, breakable, colback=yellow!5,colframe=orange!100!,fonttitle=\bfseries}{oq}
\newtcbtheorem[number within=subsection, use counter from=theorem]{conj}{Conjecture}{enhanced, breakable, colback=yellow!5,colframe=orange!100!,fonttitle=\bfseries}{conj}


\newcommand{\graph}[2]{\includegraphics[scale=#1]{images/\sectname/\subsectname/#2.png}
}

\newcommand{\fig}[3]{
    \begin{figg}{#3}{#2}
        \centering
        \graph{#1}{#2}
    \end{figg}
}

\newcommand{\phig}[2]{
    \begin{figg}{#2}{#1}
    \end{figg}
}

\makeatletter
    \def\namedlabel#1#2{\begingroup
    \def\@currentlabel{#2}
    \label{#1}\endgroup
    }
\makeatother

\newcommand{\theo}[4]{
    \begin{theorem}{#1}{#4}
        #2
        \tcblower
        \begin{proof}
        #3
        \end{proof}
    \end{theorem}
}

\newcommand{\lemm}[4]{
    \begin{lemma}{#1}{#4}
        #2
        \tcblower
        \begin{proof}
        #3
        \end{proof}
    \end{lemma}
}

\newcommand{\corr}[4]{
    \begin{corollary}{#1}{#4}
        #2
        \tcblower
        \begin{proof}
        #3
        \end{proof}
    \end{corollary}
}


\makeatletter
\newcommand{\writedef}[3]{%
  \begin{definition}{#1}{#3}
    #2
  \end{definition}
  \global
  \@namedef{gloss#3}{
    \begin{tcolorbox}[title={
    Definition \ref{def:#3}: 
    #1 (p. \pageref{def:#3})
    },enhanced, breakable, colback=blue!5,colframe=teal!100!,fonttitle=\bfseries]
        #2
    \end{tcolorbox}
   }
}
\makeatother


\newcommand{\bib}[2]{
    \printbibliography [keyword={#2},title={#1 References}, heading=subbibnumbered]
    \pagebreak
}



\newcommand{\overfullhbox}[1]{\resizebox{\textwidth}{!}{#1}}

\renewcommand{\labelitemii}{$\bullet$}

\newcommand{\bracksig}[1]{\mathbf{[[#1]]}}
\newcommand{\bracksigr}[1]{\mathbf{[[#1]]}^R}
\newcommand{\bracktier}[1]{\mathbf{(#1)}}
\newcommand{\poolsig}[1]{\mathbf{\{#1\}}}
\newcommand{\bracklabel}[1]{\mathbf{#1}}
\newcommand{\tbreak}[1]{\texttt{#1}}


\renewcommand{\A}{\mathcal{A}}
\newcommand{\B}{\mathcal{B}}
\renewcommand{\C}{\mathcal{C}}
\renewcommand{\D}{\mathcal{D}}
\renewcommand{\E}{\mathcal{E}}
\newcommand{\F}{\mathcal{F}}
\renewcommand{\G}[2]{\P{#1 \textrm{ beats } #2}}
\renewcommand{\i}[1]{\textit{#1}}
\newcommand{\LL}{\bracklabel{L}}
\newcommand{\LLone}{\bracklabel{L1}}
\newcommand{\LLtwo}{\bracklabel{L2}}
\renewcommand{\M}{\mathcal{M}}
\newcommand{\MM}{\mathbf{M}}
\newcommand{\N}{\mathbb{N}}
\renewcommand{\O}{\mathcal{O}}
\renewcommand{\P}[1]{\mathbb{P}[#1]}
\renewcommand{\PP}{\mathcal{P}}
\renewcommand{\R}{\mathcal{R}}
\renewcommand{\S}{\mathcal{S}}
\renewcommand{\SS}{\mathfrak{S}}
\newcommand{\T}{\mathcal{T}}
\newcommand{\U}{\mathcal{U}}
\renewcommand{\W}[3]{\mathbb{W}_{#1}(#2, #3)}
\newcommand{\WW}[4]{\mathbb{W}_{#1}^{#2}(#3, #4)}
\newcommand{\WWW}[4]{\mathcal{W}}
\newcommand{\x}{\textrm{x}}

\newcommand{\true}{\mathbf{true}}
\newcommand{\false}{\mathbf{false}}

\newcommand{\rank}[1]{\textrm{Rank}(#1)}

\definecolor{britishracinggreen}{rgb}{0.0, 0.26, 0.15}
\renewcommand{\check}{\textcolor{britishracinggreen}{\ding{52}}}
\newcommand{\ex}{\textcolor{red}{\ding{56}}}

\newcommand{\bcha}[1]{{\bf Chapter \ref{cha:#1}: #1}}
\newcommand{\bsec}[1]{{\bf Section \ref{sec:#1}: #1}}

\renewcommand\_{\textunderscore\linebreak[1]}